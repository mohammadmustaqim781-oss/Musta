<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Noor AI - Connection Fixed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Amiri&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #020617; 
            color: #f8fafc; 
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; 
        }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(16, 185, 129, 0.2); }
        .arabic { font-family: 'Amiri', serif; font-size: 1.6rem; line-height: 2.2; color: #10b981; }
        .content-area { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 120px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .loading-dot { animation: bounce 1.4s infinite ease-in-out; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
    </style>
</head>
<body class="flex items-center">

    <div class="w-full max-w-md h-screen flex flex-col bg-slate-950 shadow-2xl relative mx-auto border-x border-emerald-900/20">
        
        <!-- Header -->
        <header class="shrink-0 p-5 flex items-center justify-between z-20 border-b border-emerald-900/20 bg-slate-950/80 backdrop-blur-md">
            <div>
                <h1 class="text-2xl font-black bg-gradient-to-r from-emerald-400 to-teal-300 bg-clip-text text-transparent">NOOR AI</h1>
                <p class="text-[9px] tracking-[0.2em] text-emerald-500 font-bold uppercase">Reliable Connection</p>
            </div>
            <div id="status-dot" class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
        </header>

        <div class="content-area" id="scroll-container">
            <!-- Home Tab -->
            <div id="home" class="tab-content active p-5 space-y-6">
                <div class="glass p-6 rounded-3xl">
                    <p class="arabic text-right mb-4">ÙˆÙÙ…ÙÙ† ÙŠÙØªÙ‘ÙÙ‚Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙŠÙØ¬Ù’Ø¹ÙÙ„ Ù„Ù‘ÙÙ‡Ù Ù…ÙØ®Ù’Ø±ÙØ¬Ù‹Ø§</p>
                    <p class="italic text-slate-300 text-sm">"And whoever fears Allah - He will make for him a way out."</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div onclick="switchTab('chat')" class="glass p-5 rounded-3xl flex flex-col items-center cursor-pointer">
                        <span class="text-3xl mb-2">ğŸ’¬</span>
                        <span class="text-xs font-bold">Chat AI</span>
                    </div>
                    <div onclick="switchTab('tasbih')" class="glass p-5 rounded-3xl flex flex-col items-center cursor-pointer">
                        <span class="text-3xl mb-2">ğŸ“¿</span>
                        <span class="text-xs font-bold">Tasbih</span>
                    </div>
                </div>
            </div>

            <!-- Chat Tab -->
            <div id="chat" class="tab-content p-5">
                <div id="chat-messages" class="space-y-4">
                    <div class="flex justify-start">
                        <div class="glass p-4 rounded-2xl rounded-bl-none max-w-[85%] text-sm">
                            Assalamu Alaikum! My connection is now reinforced. How can I help?
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasbih Tab -->
            <div id="tasbih" class="tab-content p-6 flex flex-col items-center space-y-10">
                <div class="text-center pt-10">
                    <span id="tasbih-display" class="text-7xl font-black text-white">0</span>
                </div>
                <button onclick="countTasbih()" class="w-48 h-48 rounded-full glass border-[8px] border-emerald-500/20 flex items-center justify-center text-emerald-400 font-bold active:scale-90 transition-transform">TAP</button>
            </div>
        </div>

        <!-- Chat Input -->
        <div id="chat-input-container" class="hidden absolute bottom-24 left-4 right-4 z-30">
            <div class="glass rounded-full flex items-center p-1 shadow-2xl border-emerald-500/40">
                <input id="chat-input" type="text" placeholder="Ask Noor..." class="flex-1 bg-transparent px-5 py-3 text-sm outline-none">
                <button onclick="sendMessage()" id="send-btn" class="bg-emerald-500 text-slate-950 p-3 rounded-full active:scale-90 transition-all">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                </button>
            </div>
        </div>

        <!-- Bottom Nav -->
        <nav class="shrink-0 h-20 glass border-t border-emerald-900/30 flex items-center justify-around z-40 px-6">
            <button onclick="switchTab('home')" class="nav-btn text-emerald-500" id="nav-home">ğŸ </button>
            <button onclick="switchTab('chat')" class="nav-btn text-slate-500" id="nav-chat">ğŸ’¬</button>
            <button onclick="switchTab('tasbih')" class="nav-btn text-slate-500" id="nav-tasbih">ğŸ“¿</button>
        </nav>
    </div>

    <script>
        const apiKey = ""; // API Key (Empty for runtime injection)
        let count = 0;

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            const chatInput = document.getElementById('chat-input-container');
            tabId === 'chat' ? chatInput.classList.remove('hidden') : chatInput.classList.add('hidden');
        }

        function countTasbih() {
            count++;
            document.getElementById('tasbih-display').innerText = count;
        }

        function addMessage(role, text) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} mb-4`;
            div.innerHTML = `<div class="p-4 rounded-2xl max-w-[85%] text-sm ${role === 'user' ? 'bg-emerald-600 text-white' : 'glass'}">${text}</div>`;
            container.appendChild(div);
            document.getElementById('scroll-container').scrollTop = document.getElementById('scroll-container').scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            addMessage('user', text);
            input.value = '';
            
            const loader = document.createElement('div');
            loader.className = 'flex justify-start mb-4';
            loader.innerHTML = `<div class="glass p-4 rounded-2xl">Searching knowledge...</div>`;
            document.getElementById('chat-messages').appendChild(loader);

            // RETRY LOGIC (Exponential Backoff)
            let retries = 0;
            const maxRetries = 5;
            
            async function fetchWithRetry() {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: text }] }],
                            systemInstruction: { parts: [{ text: "You are Noor, a helpful Islamic AI." }] }
                        })
                    });

                    if (!response.ok) throw new Error('Network fail');
                    const data = await response.json();
                    loader.remove();
                    addMessage('assistant', data.candidates[0].content.parts[0].text);
                    document.getElementById('status-dot').className = "w-2 h-2 rounded-full bg-emerald-500 animate-pulse";
                } catch (error) {
                    if (retries < maxRetries) {
                        retries++;
                        document.getElementById('status-dot').className = "w-2 h-2 rounded-full bg-yellow-500 animate-ping";
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(r => setTimeout(r, delay));
                        return fetchWithRetry();
                    }
                    loader.remove();
                    document.getElementById('status-dot').className = "w-2 h-2 rounded-full bg-red-500";
                    addMessage('assistant', "I'm still having trouble connecting. This usually means the API key is missing or blocked. Please try refreshing.");
                }
            }

            fetchWithRetry();
        }

        document.getElementById('chat-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
    </script>
</body>
</html>

    
